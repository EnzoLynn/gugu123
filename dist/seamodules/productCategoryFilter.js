define(function(require,exports,module){var $=require("jquery"),common=require("modules/common");exports.initFilter=function(){for(var delfilter=function(){var me=$(this);common.spellFilter(me.attr("name"),me.val(),!0,!0)},filterobj=common.spellFilter(!1,!1,!1),fitlerstr="",hiddenKeyArr=[],hadHidden=$(".filterdiv").find('div[class*="row hidden"]'),i=0;i<hadHidden.length;i++)hiddenKeyArr.push($(hadHidden[i]).find(".filterkey").attr("data-key"));for(key in filterobj){$("div[data-key="+key+"]").parent().hide(),hiddenKeyArr.contains(key)&&hiddenKeyArr.remove(key);var keyText=$("div[data-key="+key+"]").text();fitlerstr+='<input class="filterBtn btn btn-default" type="button" name="'+key+'" value="'+keyText+filterobj[key]+'">'}0==hiddenKeyArr.length&&$(".filtermore").hide(),$(".filterStr").html(fitlerstr),""!=fitlerstr?$(".filterStrDiv").removeClass("hidden"):$(".filterStrDiv").addClass("hidden"),$(".filterBtn").on("click",delfilter),$(".filterval a").on({click:function(e){var me=$(this),filterRow=me.parents(".row");if(filterRow.hasClass("mulsel"))e.stopPropagation(),console.log(me.attr("class")),me.hasClass("select")?me.removeClass("select"):me.addClass("select");else{var fitlerKey=me.parents(".filterval").prevAll(".filterkey"),keyword=fitlerKey.attr("data-key"),value=me.attr("data-val");common.spellFilter(keyword,value)}}}),$(".morebtn").on("click",function(){var me=$(this);if("true"==me.attr("toggle")){me.attr("toggle","false");var hiddenDoms=$(me).parent().prev(".filterval").children(".temphold");hiddenDoms.removeClass("temphold"),hiddenDoms.addClass("hidden")}else{me.attr("toggle","true");var hiddenDoms=$(me).parent().prev(".filterval").children(".hidden");hiddenDoms.removeClass("hidden"),hiddenDoms.addClass("temphold")}}),$(".mulselbtn").on("click",function(){var me=$(this),filterRow=me.parents(".row");filterRow.addClass("mulsel");var hiddenDoms=filterRow.find("a[class*=hidden]");hiddenDoms.removeClass("hidden"),hiddenDoms.addClass("temphold")}),$(".mulselEnsure").on("click",function(){for(var me=$(this),filterRow=me.parents(".row"),sellist=filterRow.find("a[class*=select]"),fitlerKey=filterRow.children(".filterkey"),keyword=fitlerKey.attr("data-key"),value="",i=0;i<sellist.length;i++)value+=$(sellist[i]).attr("data-val")+"|";""!=value&&(value=value.substring(0,value.length-1),common.spellFilter(keyword,value),filterRow.removeClass("mulsel"))}),$(".mulselCancel").on("click",function(){var me=$(this),filterRow=me.parents(".row");filterRow.removeClass("mulsel");var hiddenDoms=filterRow.find("a[class*=temphold]");hiddenDoms.removeClass("temphold"),hiddenDoms.addClass("hidden")}),$(".moreitem").on("click",function(){var me=$(this);me.addClass("hidden");var lessitem=me.next(".lessitem");lessitem.removeClass("hidden");var hiddenFilterDiv=me.parents(".filterdiv").find('div[class*="row hidden"]');hiddenFilterDiv.removeClass("hidden"),hiddenFilterDiv.addClass("temphold")}),$(".lessitem").on("click",function(){var me=$(this);me.addClass("hidden");var moreitem=me.prev(".moreitem");moreitem.removeClass("hidden");var hiddenFilterDiv=me.parents(".filterdiv").find('div[class*="row temphold"]');hiddenFilterDiv.removeClass("temphold"),hiddenFilterDiv.addClass("hidden")}),$(".clearfilterbtn").on("click",function(){var url=location.protocol+"//"+location.host+location.pathname;window.location.href=url}),$(".price-star,.price-end").numeral(),$(".price-ensure").on("click",function(){var priceS=$(".price-star").val(),priceE=$(".price-end").val(),me=$(this);if(""!=priceS||""!=priceE){var fitlerKey=me.parents(".filterval").prevAll(".filterkey"),keyword=fitlerKey.attr("data-key");priceS=""==priceS?0:priceS,priceS=0>priceS?0:priceS>99999999?99999999:priceS,priceE=""==priceE?0:priceE,priceE=0>priceE?0:priceE>99999999?99999999:priceE;var value=parseInt(priceS)<parseInt(priceE)?priceS+"-"+priceE:priceE+"-"+priceS;common.spellFilter(keyword,value)}})}});